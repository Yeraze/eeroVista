# eeroVista - Project TODO List

## Pending Features

(No pending features at this time)

## In Progress

- [ ] Database Performance Optimization (2026-01-17)
  - Added VACUUM to database cleanup routine to reclaim disk space after deletions
  - Added NetworkMetric cleanup (previously only DeviceConnection and EeroNodeMetric were cleaned)
  - VACUUM only runs if fragmentation exceeds 10% threshold
  - Logs space reclaimed (before/after sizes)
  - Tested: 1.6GB fragmented database reduced to 376MB after VACUUM

## Completed
- [x] Update Notification Feature (2025-11-14)
  - Added GitHub release checking API endpoint at `/api/check-update`
  - Hourly rate limiting to prevent spamming GitHub API (1-hour cache)
  - Orange "Update is available!" notification bubble next to version number in footer
  - Uses Catppuccin Latte peach color (#fe640b) with hover effects
  - Links directly to GitHub release notes page
  - Frontend JavaScript checks for updates on page load
  - Semantic version comparison (e.g., 2.5.0 > 2.4.4)
  - Graceful error handling with console logging
  - No new dependencies (uses existing httpx)
  - All 94 tests passing
- [x] Bridge Mode Detection - PR #51 (2025-11-01)
  - Automatically detects when Eero network is in bridge mode (DHCP/routing handled by upstream router)
  - Added migration 007: connection_mode field to network_metrics table
  - Dashboard indicator: Shows "ðŸŒ‰ Bridge Mode" badge in network header when detected
  - Smart UI adaptation: Replaces bandwidth charts with informative message in bridge mode
  - Device details popup: Shows bridge mode message instead of bandwidth graphs
  - Prometheus metric: `eero_network_bridge_mode` (1=bridge, 0=router)
  - Zabbix metric: `network.bridge_mode` for monitoring integration
  - Fixed duplicate CSS `display` property bug in firmware update banner
  - Fixed migration runner: Added migration 007 to hardcoded list
  - Tested with production database: Migration runs successfully on existing installations
  - All 85 tests passing
- [x] Zabbix Multi-Network Support - PR #37 (2025-10-24)
  - Added optional `network` query parameter to all three Zabbix endpoints
  - Implemented `get_network_name_filter()` helper for consistent network resolution
  - All database queries now filtered by network_name
  - Added `{#NETWORK}` macro to device and node discovery responses
  - Updated test fixtures with network_name field
  - Comprehensive documentation: docs/zabbix.md and templates/README.md
  - Backwards compatible: defaults to first network when parameter omitted
  - Supports both single-host and multi-host Zabbix configurations
  - Tested with live data: devices, nodes, and metrics properly filtered
  - Database cleanup feature: Added POST /api/database/cleanup endpoint and Settings page UI
    - Removes all data for networks user is no longer authorized for
    - Deletes devices, connections, nodes, metrics, bandwidth, reservations, forwards
    - Returns detailed deletion counts and summary
    - Tested: Successfully cleaned 52,277 records from 2 unauthorized networks
- [x] Multi-Network Support - v2.0.0 (2025-10-23)
  - Full multi-network data collection and filtering across entire application
  - Database schema: Added network_name column to all tables with composite unique constraints
  - Migration system: Created structured migration runner with version tracking
  - Migration 001: Added network_name to 8 tables with proper indexes
  - Migration 002: Updated unique constraints from single-column to composite (network_name + column)
  - Migration 003: Fixed routing table constraints (ip_reservations composite unique index)
  - Migration 004: Intelligent network assignment correction via MAC address matching with Eero API
    - Automatically runs after first successful authentication via retry mechanism
    - Tracks skipped auth-dependent migrations and retries them post-authentication
    - Corrects legacy data by matching devices/nodes between database and current API state
    - Preserves historical data: updates device_id references via MAC matching before cleanup
    - **Preserves aliases**: copies DNS aliases from old devices to new devices before deletion
    - Tested with production database: 682,850 connections + 392 bandwidth records + 4 devices with aliases preserved âœ“
    - Prevents duplicate devices by skipping 'default' updates, deleting them after reference updates
  - Collectors: Updated device, network, speedtest, and routing collectors for multi-network support
  - API endpoints: Added optional ?network= query parameter to 20+ endpoints with backward compatibility
  - Frontend: Functional network selector dropdown with localStorage persistence across all pages
    - Fixed race condition: network selector now loads before data requests
  - Network topology: Updated graph visualization with per-network data
  - Nodes page: Per-network Eero device listing
  - Tested with 2 networks: Yoder (100 devices) + GauntletN-5G (71 devices) = 171 total
    - Migrated production database with 682,850+ historical connection records
    - Automated migration 004 correctly assigned legacy data to proper networks
  - SQLite limitations: Handled table recreation for constraint updates (DROP/CREATE pattern)
- [x] Amazon Account Shared Admin Support - v1.0.1 (2025-10-22)
  - Fixed Pydantic validation errors for shared admin accounts (#31)
  - Enables "Invite Admin" workaround for Amazon-linked networks
  - Patched NetworkInfo.amazon_directed_id and PremiumDetails.interval to Optional[str]
  - Full Amazon OAuth support deferred pending user feedback
- [x] Guest Network Support (2025-10-21)
  - Added is_guest field to DeviceConnection database model
  - Updated device collector to store guest network status from Eero API
  - Added guest network filter checkbox ("Show Guest Network") in device list UI
  - Added visual "GUEST" badge indicator for guest network devices (Catppuccin peach color)
  - Guest devices appear in Device List with clear visual distinction
  - Added database migration for existing users (automatically runs on startup)
  - Tracks guest network connection status separately from main network in time-series data
  - Fixed frontend null check for is_guest filter (explicit boolean comparison)
  - Added comprehensive test coverage:
    - 4 tests for DeviceConnection model with is_guest field
    - 3 tests for DeviceCollector storing is_guest from API data
    - 4 tests for API response structure including is_guest field
    - Tests cover null/undefined handling, defaults, and query operations
- [x] Device manufacturer field support (2025-10-21)
  - Added manufacturer field to Device database model
  - Updated device collector to store manufacturer from Eero API
  - Enhanced device name fallback chain: nickname â†’ hostname â†’ manufacturer â†’ mac_address
  - Updated Device Details popup to show individual name fields (Nickname, Hostname, Manufacturer)
  - Added database migration for existing users (automatically runs on startup)
  - Fixes devices showing MAC addresses instead of readable manufacturer names (e.g., "Oculus VR, LLC")
- [x] Improved bandwidth formatting for small values (2025-10-21)
  - Updated formatBytes() to show KB for values < 1 MB (e.g., "30.72 KB" instead of "0.03 MB")
  - Added Bytes display for values < 1 KB
  - Updated chart y-axis labels to use smart formatting (automatically shows GB/MB/KB/Bytes)
  - Changed y-axis title from "Data Usage (MB)" to "Data Usage" for accuracy
  - Fixes devices with low bandwidth showing misleading "0 MB" values
- [x] Chart data completeness and hourly view fixes (2025-10-21)
  - Fixed device bandwidth endpoint to return full date range (7/30 days) with zeros for missing data
  - Fixed device hourly chart to show only today's data (UTC timezone parsing issue)
  - Aligned Device Details popup bandwidth charts with Dashboard implementation
  - Added incomplete data indicator (lighter colors for today's data)
  - Added category scale to prevent "Invalid date" x-axis issues
  - Added "(incomplete)" notation in tooltips for today's data
  - Added `is_incomplete` flag to device bandwidth endpoint matching network endpoint
  - Corrected collection interval calculation from 60s to 30s
  - Fixed UTC timestamp parsing by appending 'Z' suffix for correct timezone conversion
  - Ensures consistent chart behavior across Dashboard and Device Details views
- [x] v0.9.0 Release - IP reservations and port forwards tracking (PR #23)
  - Backend: Database models, data collector, and API endpoints for DHCP reservations and port forwards
  - Frontend: Tabbed display on Nodes page, visual indicators in Devices List (ðŸ”’ for reserved IPs, ðŸ”€ for port forwards)
  - Device popup: Shows reservation status and configured port forwards with protocol badges
  - Performance: O(1) lookups with Map data structures, smart refresh intervals (hourly collector, 60s UI)
  - Testing: 13 unit tests covering models, collector logic, and API endpoints
  - No database migrations required (new tables created automatically)
- [x] v0.8.0 Release - UI bug fixes and improvements (PR #22)
  - Fixed hourly chart x-axis showing "Invalid date" (explicit category scale)
  - Fixed 7-day/30-day toggle not updating bandwidth chart (destroy/recreate strategy)
  - Fixed bandwidth chart date range (now shows full requested range with zeros for missing days)
  - Redesigned device popup: 2x wider (1000px), full-width graph at top, 2-column layout below
  - No database migrations required
- [x] Hourly bandwidth endpoint optimization (PR #21)
  - SQL aggregation optimization: reduced query time from 3.0s to 2.3s (23% improvement)
  - In-memory caching with 5-minute TTL: cached requests now 0.003s (99.9% faster)
  - Overall: 1000x speedup for dashboard refresh scenarios
  - Enhanced Zabbix test suite: 13 unit tests + 20 integration test stubs
- [x] v0.7.1 Release - Zabbix 6.0+ templates with auto-discovery (PR #20)
  - Zabbix 6.0+ compatibility: deprecated applicationsâ†’tags, proper UUIDs, required groups
  - New auto-discovery template with host prototypes (creates individual hosts for devices/nodes)
  - HTTPS support via configurable macros
  - Enhanced discovery metadata: IP addresses, MAC addresses, firmware versions, connection types
  - Removed separate template files, consolidated into single complete template
  - Comprehensive setup documentation with troubleshooting
- [x] v0.7.0 Release - Dashboard enhancements, timezone fixes, and performance improvements (PR #19)
  - Dashboard enhancements: incomplete data indicator, top 5 bandwidth consumers, hourly charts
  - Timezone fixes: data collection/API alignment, JavaScript date parsing
  - Performance: anti-flicker optimization for chart updates
  - Code quality: SQLAlchemy fixes, error handling improvements, test coverage
- [x] Reduce graph flicker on 30-second auto-refresh (using Chart.js update() instead of destroy/recreate)
- [x] Update 7/30 day bandwidth graphs to include today (with visual indicator for incomplete data)
- [x] Add top 5 bandwidth consumers stacked graph with "Other" category
- [x] Add hourly graph option to device info popup
- [x] PR #18 - Optimize Prometheus endpoint queries (N+1 fix, deprecation fixes, AttributeError bug fix)
- [x] PR #17 - Monitoring endpoints (Prometheus + Zabbix) with test suite
- [x] Pre-built Zabbix template with comprehensive documentation
- [x] v0.6.0 Release - Hourly bandwidth chart, timezone support, Docker optimization

---

*Last updated: 2025-11-01*
